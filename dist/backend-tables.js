!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("backendTables",[],e):"object"==typeof exports?exports.backendTables=e():t.backendTables=e()}(self,(function(){return(()=>{"use strict";var t={d:(e,a)=>{for(var s in a)t.o(a,s)&&!t.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:a[s]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};function a(t){t.extend("backendTables",(function(t){return new class{constructor(e){this.tableInstance=e,this.baseUrl=t.baseUrl,this.sortable=this.tableInstance.options.sortable,this.filterable=t.filterable,this.filterElems=t.filterElems,this.searchable=this.tableInstance.options.searchable,this.searchInput=t.searchInput,this.clearSearchButton=t.clearSearchButton,this.dataTablePage=1,this.dataTablePageSize=this.tableInstance.options.perPage,this.filterable&&(this.dataTableFilter="all"),this.searchable&&(this.dataTableSearch="",this.defaultSearch=null==this.searchInput)}sortTable(){this.reinitDataTable(),this.tableInstance.page(this.dataTablePage)}changeTablePage(){this.reinitDataTable(),this.tableInstance.page(this.dataTablePage)}loadTableData(t,e,a,s,i,l){void 0===t&&(t=""),void 0===e&&(e=""),void 0===a&&(a=""),void 0===s&&(s=""),void 0===i&&(i=""),void 0===l&&(l="");let n=`${this.baseUrl}?offset=${(e-1)*a}&limit=${a}`;return this.searchable&&(n+=`&term=${encodeURIComponent(s)}`),this.sortable&&(n+=`&sort=${i}&direction=${l}`),this.filterable&&(n+=`&filter=${t}`),{url:n,load:function(t){let s=JSON.parse(t.responseText);const i=(e-1)*a,l=s.total_count-(s.data.length+i);return[...Array(i).keys()].forEach((t=>{s.data.unshift({foo:""})})),[...Array(l).keys()].forEach((t=>{s.data.push({foo:""})})),JSON.stringify(s.data)}}}initSortButtons(t=!1){this.tableInstance.table.querySelector("thead").querySelectorAll("th").forEach((e=>{if(null!=e.dataset.sortEnabled){const a=e.innerHTML,s=document.createElement("a");s.classList.add("dataTable-backendSorter"),s.href="#",null!=e.dataset.sortDefault&&t&&(["asc","desc"].includes(e.dataset.sortDefault)?this.dataTableDirection=e.dataset.sortDefault:this.dataTableDirection="asc",this.dataTableSort=e.dataset.sortName),e.innerHTML="",s.innerHTML=a,e.appendChild(s)}}))}reinitDataTable(){const t=document.activeElement===this.searchInput;this.tableInstance.destroy(),this.sortable&&this.initSortButtons(),this.tableInstance.init({ajax:this.loadTableData(this.dataTableFilter,this.dataTablePage,this.dataTablePageSize,this.dataTableSearch,this.dataTableSort,this.dataTableDirection)}),this.searchable&&this.defaultSearch&&(this.replaceVanillaSearch(),t&&this.searchInput.focus())}initFilters(){this.filterElems.forEach((t=>{t.addEventListener("click",(t=>{t.preventDefault();const e=t.target.closest("a").dataset.filter;this.dataTablePage=1,this.dataTableFilter=e,this.reinitDataTable()}))}))}replaceVanillaSearch(){const t=this.tableInstance.wrapper.querySelector(".dataTable-search input");null==this.searchInput&&(this.searchInput=t.cloneNode(!0)),t.parentNode.replaceChild(this.searchInput,t)}initSearchInput(){let t;this.defaultSearch&&this.replaceVanillaSearch();const e=()=>{this.searchInput.value.length>=3?(this.dataTableSearch=this.searchInput.value,this.dataTablePage=1,this.reinitDataTable()):this.searchInput.value.length||(this.dataTableSearch="",this.dataTablePage=1,this.reinitDataTable())};this.searchInput.addEventListener("keyup",(()=>{clearTimeout(t),t=setTimeout(e,500)})),this.searchInput.addEventListener("keydown",(()=>{clearTimeout(t)})),null!=this.clearSearchButton&&this.clearSearchButton.addEventListener("click",(t=>{t.preventDefault(),this.searchInput.value="",e()}))}passCustomStylesToElems(){const t=/^data\-element\-(.+)$/;this.tableInstance.container.querySelector("tbody").querySelectorAll("tr").forEach((e=>{this.tableInstance.headings.forEach(((a,s)=>{for(let i=0;i<a.attributes.length;i++){const l=a.attributes[i],n=l.nodeName.match(t);if(null!=n){const t=n[1];null!=t&&e.querySelectorAll("td")[s].setAttribute(t,l.nodeValue)}}}))}))}init(){this.filterable&&this.initFilters(),this.tableInstance.destroy(),this.sortable&&this.initSortButtons(!0),this.tableInstance.init({sortable:!1,searchable:!(!0!==this.searchable||!this.defaultSearch),fixedColumns:!1,ajax:this.loadTableData(this.dataTableFilter,this.dataTablePage,this.dataTablePageSize,this.dataTableSearch,this.dataTableSort,this.dataTableDirection)}),this.tableInstance.on("datatable.page",(t=>{parseInt(t)!==this.dataTablePage&&(this.dataTablePage=parseInt(t),this.changeTablePage())})),this.tableInstance.on("datatable.perpage",(t=>{const e=parseInt(t);this.dataTablePage=Math.floor((this.dataTablePage-1)*this.dataTablePageSize/e)+1,this.dataTablePageSize=e,this.changeTablePage()})),this.tableInstance.on("datatable.init",(()=>{this.sortable&&(this.tableInstance.headings.forEach((t=>{t.dataset.sortName===this.dataTableSort&&t.classList.add(this.dataTableDirection)})),this.tableInstance.header.querySelectorAll(".dataTable-backendSorter").forEach((t=>{t.addEventListener("click",(t=>{t.preventDefault();const e=t.target.closest("th");let a;a=e.classList.contains("asc")?"desc":"asc",this.dataTableSort=e.dataset.sortName,this.dataTableDirection=a,this.sortTable()}))})))})),this.tableInstance.on("datatable.update",(()=>{this.tableInstance.data.length>0&&this.passCustomStylesToElems()})),this.searchable&&this.initSearchInput()}}(this)}))}return t.r(e),t.d(e,{initPlugin:()=>a}),e})()}));